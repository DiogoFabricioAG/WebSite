---
import BoxLayout from "../layouts/BoxLayout.astro";
import ContactBox from "../components/ContactBox.astro";
---

<section id="contacto">
    <BoxLayout>
      <h2 class="text-5xl font-Jost font-extrabold mb-10">Contacto</h2>
      <div class="flex mx-auto gap-5 justify-center w-4/5">
        <div class="w-1/2">
          <ContactBox />
          <div class="bg-white px-1.5 py-1.5 flex justify-end gap-2 text-xs">
            <div class="relative inline-block group">
              <button type="submit" form="contact-form" class="button-clean-dark">Enviar Mensaje</button>
              <span class="shadow-box-dark"></span>
            </div>
          </div>
          
          <!-- Success Message Block (initially hidden) -->
          <div id="success-message" class="mt-4 border-2 border-white  p-4" style="display: none;">
            <div class="flex items-start gap-3">
              <div class="text-3xl text-white">✓</div>
              <div class="flex-1">
                <h3 class="text-lg font-bold text-white mb-1">¡Mensaje enviado!</h3>
                <p class="text-white/90 text-sm">
                  Tus datos han sido enviados correctamente. Te responderé lo antes posible.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="w-1/3 self-start">
          <div
            class="border p-4 h-full flex flex-col justify-between bg-black/20 backdrop-blur-sm"
          >
            <div class="space-y-2">
              <h3 class="text-lg font-bold font-Jost">¿Prefieres hablar?</h3>
              <p class="text-xs leading-relaxed text-white/80">
                Agenda una reunión corta conmigo y revisamos tu idea o
                necesidad.
              </p>
            </div>
            <div class="mt-4">
              <a
                href="https://calendly.com/diogo-abregu-g-uni/personal-contact"
                target="_blank"
                rel="noopener"
                class="relative inline-block group"
              >
                <button class="button-clean-dark text-xs"
                  >Agendar reunión</button
                >
                <span class="shadow-box"></span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </BoxLayout>
  </section>

<!-- Hidden iframe to catch form submission -->
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

<script is:inline>
  let submitted = false;

  // Handle iframe load (when form is submitted)
  if (typeof window !== 'undefined') {
    window.addEventListener('load', function() {
      const iframe = document.getElementById('hidden_iframe');
      if (iframe) {
        iframe.onload = function() {
          if (submitted) {
            const form = document.getElementById('contact-form');
            const successMessage = document.getElementById('success-message');
            
            if (successMessage) {
              successMessage.style.display = 'block';
              
              // Auto-hide after 6 seconds
              setTimeout(() => {
                successMessage.style.display = 'none';
              }, 6000);
            }
            
            if (form) {
              form.reset();
            }

            submitted = false;
          }
        };
      }

      // Set submitted flag on form submit
      const contactForm = document.getElementById('contact-form');
      if (contactForm) {
        contactForm.addEventListener('submit', function() {
          submitted = true;
        });
      }
    });
  }
</script>