---
interface TechIcon {
  name: string;
  icon: string;
}

interface Metric {
  label: string;
  value: string;
}

interface Props {
  id: string;
  title: string;
  description: string;
  finishDate: string;
  status?: 'done' | 'wip' | 'paused' | 'mvp';
  icon?: string;
  liveUrl?: string | null;
  repoUrl?: string | null;
  imagesUrl?: string | null;
  features?: string[];
  metrics?: Metric[];
  tags?: string[];
  techs?: TechIcon[];
  images?: string[];
}

const {
  id,
  title,
  description,
  finishDate,
  status,
  icon,
  techs = [],
  liveUrl,
  repoUrl,
  imagesUrl,
  features = [],
  metrics = [],
  tags = [],
  images = [],
} = Astro.props as Props;

// Heurística rápida para mostrar efecto de desvanecido + '...' cuando el texto es largo
const showFade = description.length > 180;

// Mapeo de status a estilos
const statusConfig = {
  done: { label: 'Completado', class: 'bg-green-500/20 text-green-300 border-green-500/30' },
  wip: { label: 'En Progreso', class: 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30' },
  paused: { label: 'Pausado', class: 'bg-gray-500/20 text-gray-300 border-gray-500/30' },
  mvp: { label: 'MVP', class: 'bg-blue-500/20 text-blue-300 border-blue-500/30' },
};

const statusDisplay = status ? statusConfig[status] : null;
---


<article class="flex flex-col h-[320px] md:h-[275px] overflow-hidden  transition-all duration-300 group bg-gradient-to-br from-transparent to-white/5">
  
  <div class="flex  justify-between gap-2  ">
    <div class="bg-white  px-2 flex items-center  w-fit text-xs text-black font-light">{finishDate}</div>
    {statusDisplay && (
      <span class={`px-2 py-0.5 text-[10px] font-semibold  border ${statusDisplay.class}`}>
        {statusDisplay.label}
      </span>
    )}
  </div>

  <!-- Main content area -->
  <div class="border-t border border-white  font-medium px-3 py-3 flex-1 flex flex-col relative">
    <!-- Title -->
    <h3 class="text-xl md:text-2xl font-bold leading-snug mb-1 line-clamp-2" style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">
      {title}
    </h3>

    <!-- Description with fade effect -->
    <div class="relative flex-1 ">
      <p class="text-xs font-light leading-relaxed line-clamp-4 pr-3">
        {description}
      </p>
      {showFade && (
        <span class="pointer-events-none absolute bottom-0 right-0 pl-4 text-xs font-semibold tracking-widest bg-gradient-to-l from-black via-black/90 to-transparent">
          ...
        </span>
      )}
    </div>

    
    <!-- Metrics (if provided) -->
    {metrics.length > 0 && (
      <div class="grid grid-cols-3 gap-2 mb-3 text-center">
        {metrics.slice(0, 3).map((metric) => (
          <div class="bg-white/5 border border-white/10 rounded px-1 py-1">
            <p class="text-xs font-bold text-white">{metric.value}</p>
            <p class="text-[9px] text-white/60 leading-tight">{metric.label}</p>
          </div>
        ))}
      </div>
    )}

    <!-- Tech icons -->
    {techs.length > 0 && (
      <div class="flex flex-wrap justify-start mt-auto gap-2 shrink-0">
        {techs.slice(0, 6).map((tech) => (
          <img 
            src={tech.icon} 
            alt={tech.name} 
            title={tech.name}
            class="h-6 w-6 hover:scale-105 duration-150 transition-opacity" 
          />
        ))}
      </div>
    )}

  </div>

  <!-- Footer: Action buttons -->
  <div class="px-2 py-2 bg-white/95 w-full flex flex-wrap justify-between items-center gap-2 text-[10px] mt-auto border-t border-white/30">
    <!-- Left: external links -->
    <div class="flex gap-1.5">
      {liveUrl && (
        <a 
          href={liveUrl} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-2 py-1  text-black border-black border font-light"
          title="Ver proyecto en vivo"
        >
          Live
        </a>
      )}
      {repoUrl && (
        <a 
          href={repoUrl} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-2 py-1  text-black border-black border font-light"
          title="Ver repositorio"
        >
          Repo
        </a>
      )}
      {imagesUrl && (
        <a 
          href={imagesUrl} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-2 py-1  text-black border-black border font-light"
          title="Ver galería"
        >
          Media
        </a>
      )}
    </div>

    <!-- Right: Details button -->
    <div class="relative inline-block group ml-auto">
      <button class="button-clean-dark">Ver Detalles</button>
      <span class="shadow-box-dark"></span>
    </div>
  </div>
</article>



    <!-- Features list (if provided)
    {features.length > 0 && (
      <div class="mb-2 space-y-1">
        {features.slice(0, 3).map((feature) => (
          <div class="flex items-start gap-1.5 text-[10px] text-white/70">
            <span class="text-green-400 mt-0.5">✓</span>
            <span class="leading-tight">{feature}</span>
          </div>
        ))}
      </div>
    )} -->


    <!-- Tags (if provided) -->
    <!-- {tags.length > 0 && (
      <div class="flex flex-wrap gap-1 mt-2">
        {tags.slice(0, 4).map((tag) => (
          <span class="text-[9px] px-1.5 py-0.5 bg-white/10 text-white/70 rounded-sm border border-white/20">
            {tag}
          </span>
        ))}
      </div>
    )} -->