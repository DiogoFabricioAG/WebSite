---

---

<nav id="site-nav" class="sticky top-0 z-50 w-full md:w-4/5 mx-auto transition-all duration-300 px-2 md:px-0">
  <div class="grid grid-cols-3 md:grid-cols-4 items-center px-2 md:px-8">
    <a
      href="#inicio"
      class="justify-self-start col-span-1 hidden md:block hover:scale-105 transition-transform duration-300"
    >
      <img
        src="/logo-portfolio.png"
        alt="Logo"
        class="logo-img my-3 md:my-4 h-16 md:h-24 logo-icon nav:transition-all"
        transition:name="portfolio-logo"
      />
    </a>

    <ul
      class="nav-center flex col-span-3 md:col-span-2 items-center justify-center gap-1 p-1 md:gap-6 py-2"
    >
      <li>
        <a href="#inicio" class="nav-link flex items-center gap-2">
          <span
            class="icon-btn items-center justify-center border border-white/30 lg:size-10 sm:size-7 size-6 bg-white/10 hover:bg-white/20 transition-colors"
          >
            <img src="/icons/home.svg" alt="Inicio" class="size-3 md:size-5" />
          </span>
        </a>
      </li>
      <li>
        <a href="#sobre-mi" class="nav-link flex items-center gap-2">
          <span
            class="icon-btn items-center justify-center border border-white/30 lg:size-10 sm:size-7 size-6 bg-white/10 hover:bg-white/20 transition-colors"
          >
            <img src="/icons/me.svg" alt="Sobre mí" class="size-3 md:size-5" />
          </span>
          <span class="nav-text nav-li text-sm md:text-base">Sobre mí</span>
        </a>
      </li>
      <li>
        <a href="#experiencia" class="nav-link flex items-center gap-2">
          <span
            class="icon-btn items-center justify-center border border-white/30 lg:size-10 sm:size-7 size-6 bg-white/10 hover:bg-white/20 transition-colors"
          >
            <img src="/icons/tie.svg" alt="Experiencia" class="size-3 md:size-5" />
          </span>
          <span class="nav-text nav-li text-sm md:text-base">Experiencia</span>
        </a>
      </li>
      <li>
        <a href="#proyectos" class="nav-link flex items-center gap-2">
          <span
            class="icon-btn items-center justify-center border border-white/30 lg:size-10 sm:size-7 size-6 bg-white/10 hover:bg-white/20 transition-colors"
          >
            <img src="/icons/briefcase.svg" alt="Proyectos" class="size-3 md:size-5" />
          </span>
          <span class="nav-text nav-li text-sm md:text-base">Proyectos</span>
        </a>
      </li>
      
      <li>
        <a href="/bot" class="nav-link flex items-center gap-2">
          <span
            class="icon-btn items-center justify-center border border-white/30 lg:size-10 sm:size-7 size-6 bg-white/10 hover:bg-white/20 transition-colors"
          >
            <img src="/icons/bot.svg" alt="Sobre mí" class="size-3 md:size-5 " />
          </span>
        </a>
      </li>
    </ul>

    <!-- Right: Action button (hidden in compact) -->
    <div class="nav-actions justify-self-end col-span-1 hidden md:block">
      <div class="relative inline-block group">
        <a href="/bot" class=" button-clean">Activar Bot</a>
        <span
          class="absolute inset-0 duration-100 group-hover:translate-x-1 group-hover:translate-y-1 group-hover:bg-white/20 justify-center text-white pointer-events-none"
        ></span>
      </div>
    </div>
  </div>
</nav>

<script>
  // Initialize navbar behavior - Works with View Transitions
  function initNavbar() {
    const nav = document.getElementById("site-nav");
    if (!nav) return;

    // Shrink navbar on scroll and switch to icon-only links
    function onScroll() {
      if (!nav) return;
      if (window.scrollY > 100) nav.classList.add("nav--compact");
      else nav.classList.remove("nav--compact");
    }
    
    // Check scroll position immediately
    onScroll();
    
    // Smooth scroll with offset for sticky navbar
    function smoothScrollTo(targetId: string) {
      const el = document.querySelector(targetId);
      if (!el || !nav) return;
      const navHeight = nav.offsetHeight || 0;
      const rect = el.getBoundingClientRect();
      const absoluteY = rect.top + window.scrollY - navHeight - 8;
      window.scrollTo({ top: absoluteY, behavior: 'smooth' });
    }

    // Add scroll listener
    const handleScroll = () => onScroll();
    window.addEventListener("scroll", handleScroll);

    // Add smooth scroll to hash links
    const handleHashClick = (e: Event) => {
      const href = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
      if (href && href.startsWith('#')) {
        e.preventDefault();
        smoothScrollTo(href);
      }
    };

    document.querySelectorAll('#site-nav a[href^="#"]').forEach(a => {
      a.addEventListener('click', handleHashClick);
    });

    // Cleanup function
    return () => {
      window.removeEventListener("scroll", handleScroll);
    };
  }

  // Initialize on load and after View Transitions
  let cleanupNav = initNavbar();

  document.addEventListener('astro:after-swap', () => {
    if (cleanupNav) cleanupNav();
    cleanupNav = initNavbar();
  });
</script>

<style>
  /* Logo size transitions */
  #site-nav .logo-img {
    transition:
      height 0.25s ease,
      margin 0.25s ease;
  }

  #site-nav.nav--compact .logo-icon {
    display: none;
  }

  #site-nav.nav--compact .logo-img {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }

  /* Smooth switch: text fades out, icons fade in */
  #site-nav .nav-text {
    display: inline-block;
    white-space: nowrap;
    opacity: 1;
    max-width: 200px;
    margin-left: 0.25rem;
    transition:
      opacity 0.25s ease,
      max-width 0.25s ease,
      margin 0.25s ease;
  }
  #site-nav.nav--compact .nav-text {
    display: none;
    max-width: 0;
    margin: 0;
    pointer-events: none;
  }
  /* Icon button reveal (no display toggles to allow transition) */
  #site-nav .icon-btn {
    opacity: 0;
    overflow: hidden;
    display: flex;
    transform: scale(0.9);
    transition:
      opacity 0.25s ease,
      width 0.25s ease,
      transform 0.25s ease,
      background-color 0.25s ease,
      border-color 0.25s ease;
  }
  #site-nav.nav--compact .icon-btn {
    opacity: 1;
    transform: scale(1);
  }

  /* Background opacity only on center icons area in compact */
  #site-nav .nav-center {
    transition:
      background-color 0.25s ease,
      padding 0.25s ease,
      border-color 0.25s ease;
  }
  #site-nav.nav--compact .nav-center {
    margin-top: 20px;
    margin-inline: auto;
    width: 75%;
    background-color: rgba(0, 0, 0, 0.9);
    padding-block: 1rem;
    padding-inline: 0.5rem;
    border: 1px solid rgba(255, 255, 255, 0.5);
  }
  /* Actions fade out smoothly */
  #site-nav .nav-actions {
    transition:
      opacity 0.25s ease,
      transform 0.25s ease;
  }
  #site-nav.nav--compact .nav-actions {
    opacity: 0;
    pointer-events: none;
    transform: translateY(4px);
  }

  /* Mobile-first tweaks */
  @media (max-width: 640px) {
    #site-nav .nav-text {
      display: none !important;
      max-width: 0;
      margin: 0;
      pointer-events: none;
    }
    #site-nav .icon-btn {
      opacity: 1;
    }
    #site-nav .icon-btn img {
      width: 1rem;
      height: 1rem;
    }
    #site-nav .nav-center {
      gap: 0.5rem;
    }
  }
</style>
